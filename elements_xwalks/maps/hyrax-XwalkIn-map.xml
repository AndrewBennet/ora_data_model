<xwalkin:consolidated-maps xmlns:xwalk="http://www.symplectic.co.uk/elements/xwalkcommon" xmlns:xwalkin="http://www.symplectic.co.uk/elements/xwalkin" xmlns:mods="http://www.loc.gov/mods/v3" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:ora="http://ora.ox.ac.uk/terms/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxx/" xmlns:foxml="info:fedora/fedora-system:def/foxml#" xmlns:oxds="http://vocab.ox.ac.uk/dataset/schema#" xmlns:symp="http://symplectic/symplectic-elements:def/model#" xmlns:ora_admin="http://ora.ox.ac.uk/vocabs/admin">

  <xwalk:field-maps>

    <xwalk:field-map name="file-metadata-map">
      <xwalk:field-mapping to="file">
        <xwalk:field-source from="ora:repository_file">
          <xwalk:field-source from="ora:filesetId" data-part="file:proprietary-id" />
          <xwalk:field-source from="symp:hasPublicUrl" data-part="file:url" />
          <xwalk:field-source from="dc:title" data-part="file:name" />
          <xwalk:field-source from="foxml:datastream" data-part="file:mime-type" />
          <xwalk:field-source from="dcterms:extent" data-part="file:size" />
          <xwalk:field-source from="rioxxterms:version" data-part="file:version" />
          <xwalk:field-source from="oxds:embargoedUntil" data-part="file:embargo-release-date" />
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>

    <xwalk:field-map name="default-map">
      <xwalk:include-field-map name="contributors" />
      <xwalk:include-field-map name="identifiers" />
      <xwalk:include-field-map name="journal-markup" />
      <xwalk:include-field-map name="access-conditions" />

      <xwalk:field-mapping to="public-url">
        <xwalk:field-source from="location/url" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="repository-status">
        <xwalk:if>
          <xwalk:condition operator="or">
            <xwalk:condition operator="has-value" argument-field="location/url" />
            <xwalk:condition operator="has-value" argument-field="/mods:mods/mods:extension/ora_admin:admin/ora_admin:record_publication_date" select-using="xpath" />
          </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source value="Public" />
          </xwalk:result>
          <xwalk:else>
            <xwalk:result>
              <xwalk:field-source from="/mets:mets/mets:amdSec/mets:sourceMD/mets:mdWrap/mets:xmlData/mods:mods/mods:extension/ora_admin:admin/ora_admin:record_review_status" select-using="xpath" value-map="repository-status" />
            </xwalk:result>
          </xwalk:else>
        </xwalk:if>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="abstract">
        <xwalk:field-source from="abstract" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="title">
        <xwalk:field-source from="titleInfo/title" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="keywords">
        <xwalk:field-source from="subject/genre" />
      </xwalk:field-mapping>

      <xwalk:field-mapping to="field-47">
        <xwalk:field-source from="titleInfo/subTitle" />
      </xwalk:field-mapping>

      <xwalk:field-mapping to="language">
        <xwalk:field-source from="language/languageTerm" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="acceptance-date">
        <xwalk:field-source from="/mods:mods/mods:originInfo/mods:dateOther[@type = 'date_of_acceptance']" select-using="xpath" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="publication-date">
        <xwalk:field-source from="originInfo/dateIssued" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="publication-status">
        <xwalk:field-source from="/mods:mods/mods:relatedItem[@type = 'host']/mods:physicalDescription/mods:form[@type = 'status']" select-using="xpath" value-map="publication-status" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="publisher-url">
        <xwalk:field-source from="/mods:mods/mods:placeTerm[@type = 'code']" select-using="xpath" />
      </xwalk:field-mapping>


<!-- add new -->
      <xwalk:field-mapping to="series">
        <xwalk:field-source from="/mods:mods/mods:relatedItem[@type='series']/mods:titleInfo/mods:title" select-using="xpath"/>
      </xwalk:field-mapping>




    </xwalk:field-map>

    <xwalk:field-map name="contributors">
      <xwalk:field-mapping to="authors">
        <xwalk:field-source from="/mods:mods/mods:name[@type = 'personal' and mods:role/mods:roleTerm/text() = 'Author']" select-using="xpath">
          <xwalk:field-source from="/*/mods:namePart[@type = 'given']" select-using="xpath" data-part="person:firstnames" />
          <xwalk:field-source from="/*/mods:namePart[@type = 'family']" select-using="xpath" data-part="person:lastname" />
          <xwalk:field-source from="nameIdentifier" data-part="person:identifier">
            <xwalk:field-source from="@type" value-map="name-identifier" data-part="identifier:scheme" />
            <xwalk:field-source from="." data-part="identifier:value" />
          </xwalk:field-source>
          <xwalk:field-source data-part="person:address" from="/*/mods:affiliation/ora:affiliation" select-using="xpath">
            <xwalk:field-source data-part="address:organisation" from="/*/ora:affiliationComponent[@type='institution']" select-using="xpath" />
            <xwalk:field-source data-part="address:suborganisation" from="/*/ora:affiliationComponent[@type='department']" select-using="xpath" />
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>

    <xwalk:field-map name="identifiers">
      <xwalk:field-mapping to="issn">
        <xwalk:field-source from="/*/mods:identifier[@type = 'issn']" select-using="xpath" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="doi">
        <xwalk:field-source from="/*/mods:identifier[@type = 'doi']" select-using="xpath" />
      </xwalk:field-mapping>

    <!-- DS test added 17/09/2019 -->
      <xwalk:field-mapping to="isbn-13">
        <xwalk:field-source from="/*/mods:identifier[@type = 'isbn13']" select-using="xpath" />
      </xwalk:field-mapping>
    </xwalk:field-map>

    <!-- End of test -->

    <xwalk:field-map name="journal-markup">
      <xwalk:field-mapping to="pagination">
        <xwalk:field-source from="/*/mods:relatedItem[@type = 'host']/mods:part/mods:extent[@unit = 'pages']/mods:list" select-using="xpath" format="pagination:start-end" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="volume">
        <xwalk:field-source from="/*/mods:relatedItem[@type = 'host']/mods:part/mods:detail[@type = 'volume']/mods:number" select-using="xpath" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="journal">
        <xwalk:field-source from="/*/mods:relatedItem[@type='host']/mods:titleInfo/mods:title" select-using="xpath" />
      </xwalk:field-mapping>
    </xwalk:field-map>

    <xwalk:field-map name="access-conditions">
      <xwalk:field-mapping to="publisher-licence">
        <xwalk:field-source from="/mods:mods/mods:accessCondition[@type='licence']" select-using="xpath" />
      </xwalk:field-mapping>
      <xwalk:field-mapping to="author-licence">
        <!-- TODO: We might want to value-map this URL-style identifier to a nicer display name -->
        <xwalk:field-source from="/mods:mods/mods:accessCondition[@type='record_ora_deposit_licence']" select-using="xpath" />
      </xwalk:field-mapping>
    </xwalk:field-map>
  </xwalk:field-maps>

  <xwalk:value-maps>
    <xwalk:value-map name="name-identifier">
      <xwalk:value-mapping from="orcid_identifier" to="orcid" />
      <xwalk:value-mapping from="email_address" to="email-address" />
      <xwalk:value-mapping from="contributor_record_identifier" action="ignore-this-value" />
      <xwalk:value-mapping from="institutional_identifier" action="ignore-this-value" />
      <xwalk:value-mapping from="figshare-for-institutions-user-id" action="ignore-this-value" />
    </xwalk:value-map>

    <xwalk:value-map name="repository-status">
      <xwalk:value-mapping from="Deposited" to="Private" />
      <xwalk:value-mapping from="In review" to="Private (in review)" />
      <xwalk:value-mapping from="Public" to="Public" />
      <xwalk:otherwise-mapping to="Unknown" />
    </xwalk:value-map>

    <xwalk:value-map name="publication-status">
      <xwalk:value-mapping from="notpublished" to="Unpublished" />
      <xwalk:value-mapping from="submitted" to="Submitted" />
      <xwalk:value-mapping from="accepted" to="Accepted" />
      <xwalk:value-mapping from="inpress" to="In preparation" />
      <xwalk:value-mapping from="published" to="Published" />
      <xwalk:otherwise-mapping to="Published online" />
    </xwalk:value-map>

  </xwalk:value-maps>

  <xwalkin:object-type-selector>


    <xwalk:choose>

<!-- ORA OUTPUT TYPES WITHOUT SUBTYPES-->
      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Journal article</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="journal-article" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Patent</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="patent" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Internet publication</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="internet-publication" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Composition</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="composition" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Working paper</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-report" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Report</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="report" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Thesis</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="thesis-dissertation" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Ephemera</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-ephemera" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>-->

<!-- ORA BOOK AND SUBTYPES-->
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Book</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Edited book</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-book" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Book</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Scholarly edition</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="scholarly-edition" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Book</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Translation</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-translation" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Book</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="book" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>



<!-- ORA BOOK SECTION AND SUBTYPES--> 
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Book section</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Chapter</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="chapter" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

<!-- CONFERENCE ITEM AND SUBTYPES-->
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Conference item</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Exhibition</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="exhibition" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Conference item</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Poster</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="poster" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Conference item</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Presentation</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="presentation" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Conference item</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="conference-paper" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>


  

<!-- ORA DATASET AND SUBTYPES--> 
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Software</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="software" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Design</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="design" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>


      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Media</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="media" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>


      <!-- symplectic_to_ora_field_mapping-2.1 gives Dataset/Media to both figure and media. Suggest it only goes to  Media (as above).
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Media</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="figure" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>
    -->

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Fileset</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="fileset" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Dataset</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="dataset" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

<!-- ORA PHYSICAL OBJECT AND SUBTYPES--> 
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Physical object</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Artefact</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="artefact" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

<!--Rather than a nested conditional I have written Device and Product separately to help readability-->

      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Physical object</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Device</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-device-product" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
          <xwalk:condition operator="and">
            <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Physical object</xwalk:condition>
            <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Product</xwalk:condition>
          </xwalk:condition>
          <xwalk:result>
            <xwalkin:object-type-selection object-type="c-device-product" category="publication" field-map="default-map" />
          </xwalk:result>
        </xwalk:when>

<!-- subject to confirmation that can exist without a subtype-->
      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Physical object</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="c-device-product" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>


<!-- ORA COMPOSITION AND SUBTYPES--> 
      <xwalk:when>
        <xwalk:condition operator="and">
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Composition</xwalk:condition>
          <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='sub_type_of_work']" select-using="xpath">Performance</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="performance" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

      <xwalk:when>
        <xwalk:condition operator="equals" argument-field="/*/mods:genre[@type='type_of_work']" select-using="xpath">Composition</xwalk:condition>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="composition" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:when>

<!-- END OF ORA PERFORMANCE AND SUBTYPES--> 


      <xwalk:otherwise>
        <xwalk:result>
          <xwalkin:object-type-selection object-type="other" category="publication" field-map="default-map" />
        </xwalk:result>
      </xwalk:otherwise>
    </xwalk:choose>

  </xwalkin:object-type-selector>

</xwalkin:consolidated-maps>